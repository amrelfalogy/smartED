<div class="auth-container">
  <div class="auth-card">
    <div class="auth-header">
      <div class="logo-section">
        <img src="assets/imgs/logo.png" alt="Logo" class="auth-logo" />
        <h1>استعادة كلمة المرور</h1>
        <p>أدخل بريدك الإلكتروني لإعادة تعيين كلمة المرور</p>
      </div>
    </div>

    <div class="auth-body">
      <!-- Step 1: Email Input -->
      <div class="step-container" *ngIf="currentStep === 1">
        <div class="step-header">
          <div class="step-icon">📧</div>
          <h3>أدخل بريدك الإلكتروني</h3>
          <p>سنرسل لك رابط إعادة تعيين كلمة المرور</p>
        </div>

        <form [formGroup]="emailForm" (ngSubmit)="sendResetEmail()" class="auth-form">
          <div class="form-section">
            <div class="form-group">
              <label for="email">البريد الإلكتروني *</label>
              <input
                type="email"
                id="email"
                formControlName="email"
                class="form-control"
                [class.error]="isFieldInvalid('email')"
                placeholder="example@email.com"
              />
              <div class="error-message" *ngIf="isFieldInvalid('email')">
                {{ getFieldError('email') }}
              </div>
            </div>
          </div>

          <div class="reset-error" *ngIf="resetError">
            <i class="fas fa-exclamation-circle"></i>
            {{ resetError }}
          </div>

          <button
            type="submit"
            class="submit-btn"
            [disabled]="emailForm.invalid || isLoading"
            [class.loading]="isLoading"
          >
            <span *ngIf="!isLoading">إرسال رابط الاستعادة</span>
            <span *ngIf="isLoading">
              <i class="fas fa-spinner fa-spin"></i>
              جاري الإرسال...
            </span>
          </button>
        </form>
      </div>

      <!-- Step 2: Verification Code -->
      <div class="step-container" *ngIf="currentStep === 2">
        <div class="step-header">
          <div class="step-icon">🔢</div>
          <h3>أدخل رمز التحقق</h3>
          <p>تم إرسال رمز مكون من 6 أرقام إلى <strong>{{ userEmail }}</strong></p>
        </div>

        <form [formGroup]="codeForm" (ngSubmit)="verifyCode()" class="auth-form">
          <div class="form-section">
            <div class="verification-code">
              <input
                type="text"
                *ngFor="let digit of codeDigits; let i = index"
                [id]="'code-' + i"
                [(ngModel)]="codeDigits[i]"
                [ngModelOptions]="{standalone: true}"
                class="code-input"
                maxlength="1"
                inputmode="numeric"
                pattern="[0-9]*"
                autocomplete="one-time-code"
           
              />
            </div>
            
            <div class="error-message" *ngIf="codeError">
              {{ codeError }}
            </div>
          </div>

          <div class="resend-section">
            <p *ngIf="!canResend">
              يمكنك طلب رمز جديد خلال {{ resendCountdown }} ثانية
            </p>
            <button
              type="button"
              class="resend-btn"
              *ngIf="canResend"
              (click)="resendCode()"
              [disabled]="isLoading"
            >
              إعادة إرسال الرمز
            </button>
          </div>

          <button
            type="submit"
            class="submit-btn"
            [disabled]="!isCodeComplete() || isLoading"
            [class.loading]="isLoading"
          >
            <span *ngIf="!isLoading">تحقق من الرمز</span>
            <span *ngIf="isLoading">
              <i class="fas fa-spinner fa-spin"></i>
              جاري التحقق...
            </span>
          </button>
        </form>
      </div>

      <!-- Step 3: New Password -->
      <div class="step-container" *ngIf="currentStep === 3">
        <div class="step-header">
          <div class="step-icon">🔐</div>
          <h3>كلمة مرور جديدة</h3>
          <p>أدخل كلمة المرور الجديدة الخاصة بك</p>
        </div>

        <form [formGroup]="passwordForm" (ngSubmit)="resetPassword()" class="auth-form">
          <div class="form-section">
            <div class="form-group">
              <label for="newPassword">كلمة المرور الجديدة *</label>
              <div class="password-input">
                <input
                  [type]="showPassword ? 'text' : 'password'"
                  id="newPassword"
                  formControlName="newPassword"
                  class="form-control"
                  [class.error]="isPasswordFieldInvalid('newPassword')"
                  placeholder="أدخل كلمة مرور قوية"
                />
                <button
                  type="button"
                  class="password-toggle"
                  (click)="togglePassword()"
                >
                  <i [class]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                </button>
              </div>
              <div class="password-strength">
                <div class="strength-bar" [class]="getPasswordStrength()"></div>
                <span class="strength-text">{{ getPasswordStrengthText() }}</span>
              </div>
              <div class="error-message" *ngIf="isPasswordFieldInvalid('newPassword')">
                {{ getPasswordFieldError('newPassword') }}
              </div>
            </div>

            <div class="form-group">
              <label for="confirmPassword">تأكيد كلمة المرور *</label>
              <input
                type="password"
                id="confirmPassword"
                formControlName="confirmPassword"
                class="form-control"
                [class.error]="isPasswordFieldInvalid('confirmPassword')"
                placeholder="أعد إدخال كلمة المرور"
              />
              <div class="error-message" *ngIf="isPasswordFieldInvalid('confirmPassword')">
                {{ getPasswordFieldError('confirmPassword') }}
              </div>
            </div>
          </div>

          <button
            type="submit"
            class="submit-btn"
            [disabled]="passwordForm.invalid || isLoading"
            [class.loading]="isLoading"
          >
            <span *ngIf="!isLoading">تحديث كلمة المرور</span>
            <span *ngIf="isLoading">
              <i class="fas fa-spinner fa-spin"></i>
              جاري التحديث...
            </span>
          </button>
        </form>
      </div>

      <!-- Step 4: Success -->
      <div class="step-container success-step" *ngIf="currentStep === 4">
        <div class="step-header">
          <div class="step-icon success">✅</div>
          <h3>تم بنجاح!</h3>
          <p>تم تحديث كلمة المرور بنجاح</p>
        </div>

        <button class="submit-btn" (click)="goToLogin()">
          <i class="fas fa-sign-in-alt"></i>
          تسجيل الدخول الآن
        </button>
      </div>

      <!-- Back to Login -->
      <div class="auth-footer" *ngIf="currentStep < 4">
        <p>
          تذكرت كلمة المرور؟
          <a routerLink="/auth/login" class="auth-link">تسجيل الدخول</a>
        </p>
      </div>
    </div>
  </div>
</div>