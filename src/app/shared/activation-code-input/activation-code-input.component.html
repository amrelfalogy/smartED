<div class="activation-code-input">
  <!-- Debug Panel (remove in production) -->
  <div class="debug-panel" style="background: #f0f8ff; padding: 12px; margin-bottom: 16px; border-radius: 8px; border: 2px solid #007bff; font-family: monospace; font-size: 12px;">
    <h4 style="margin: 0 0 8px 0; color: #007bff;">🔧 Debug Info</h4>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
      <div><strong>Form Valid:</strong> {{ debugInfo.formValid ? '✅' : '❌' }}</div>
      <div><strong>Button Disabled:</strong> {{ debugInfo.buttonDisabled ? '❌' : '✅' }}</div>
      <div><strong>Is Submitting:</strong> {{ isSubmitting ? '⏳' : '✅' }}</div>
      <div><strong>Validation Valid:</strong> {{ validationResult.isValid ? '✅' : '❌' }}</div>
    </div>
    <div style="margin-top: 8px;">
      <strong>Input Value:</strong> "{{ codeControl.value || 'empty' }}" ({{ (codeControl.value || '').length }}/21)
    </div>
    <div style="margin-top: 4px;">
      <strong>Last API Call:</strong> {{ debugInfo.lastApiCall ? debugInfo.lastApiCall.toLocaleTimeString() : 'None' }}
    </div>
    <div style="margin-top: 4px;" *ngIf="debugInfo.validationErrors.length > 0">
      <strong style="color: #dc3545;">Validation Errors:</strong>
      <ul style="margin: 4px 0; padding-right: 16px; color: #dc3545;">
        <li *ngFor="let error of debugInfo.validationErrors">{{ error }}</li>
      </ul>
    </div>
  </div>

  <!-- Header -->
  <div class="activation-header">
    <div class="header-content">
      <h3 class="activation-title">
        <i class="pi pi-key me-2"></i>
        {{ label }}
      </h3>
      <button class="btn btn-ghost btn-sm close-btn" (click)="onCancel()" [disabled]="isSubmitting">
        <i class="pi pi-times"></i>
      </button>
    </div>
    <p class="activation-description" *ngIf="showInstructions">
      أدخل رمز التفعيل للحصول على وصول فوري للمحتوى
    </p>
  </div>

  <!-- Input Form -->
  <form (ngSubmit)="onSubmit()" class="activation-form" #activationForm="ngForm">
    <!-- Code Input Field -->
    <div class="form-group">
      <label class="form-label">
        <i class="pi pi-shield me-2"></i>
        رمز التفعيل
      </label>
      <div class="input-container">
        <input
          type="text"
          class="form-control code-input"
          [formControl]="codeControl"
          [placeholder]="placeholder"
          [class.is-valid]="validationResult.isValid && codeControl.value"
          [class.is-invalid]="hasValidationErrors && codeControl.touched"
          [attr.aria-describedby]="showValidationHelp ? 'code-help' : null"
          autocomplete="off"
          spellcheck="false"
          maxlength="21"
          (paste)="onCodePaste($event)"
          #codeInput
        >
        <div class="input-icons">
          <i class="pi pi-check text-success" *ngIf="validationResult.isValid && codeControl.value"></i>
          <i class="pi pi-times text-danger" *ngIf="hasValidationErrors && codeControl.touched"></i>
          <i class="pi pi-spinner pi-spin text-primary" *ngIf="isSubmitting"></i>
        </div>
      </div>

      <!-- Quick Test Buttons -->
      <div class="test-codes" style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
        <small><strong>اختبار سريع:</strong></small>
        <div style="display: flex; gap: 5px; flex-wrap: wrap; margin-top: 5px;">
          <button type="button" class="btn btn-sm btn-outline-info" 
                  (click)="testCode('LMS-9B31BD06-MFU43820')"
                  style="font-size: 10px; padding: 2px 6px;">
            Test Available Code
          </button>
          <button type="button" class="btn btn-sm btn-outline-secondary" 
                  (click)="testCode('LMS-INVALID-CODE123')"
                  style="font-size: 10px; padding: 2px 6px;">
            Test Invalid
          </button>
          <button type="button" class="btn btn-sm btn-outline-warning" 
                  (click)="testCode('')"
                  style="font-size: 10px; padding: 2px 6px;">
            Clear
          </button>
        </div>
      </div>

      <!-- Validation Help -->
      <div id="code-help" class="form-help" *ngIf="showValidationHelp">
        <div class="validation-errors" *ngIf="hasValidationErrors">
          <div class="error-item" *ngFor="let error of validationResult.errors">
            <i class="pi pi-exclamation-circle"></i>
            <span>{{ error }}</span>
          </div>
        </div>
        <div class="validation-suggestions" *ngIf="validationResult.suggestions && validationResult.suggestions.length > 0">
          <div class="suggestion-item" *ngFor="let suggestion of validationResult.suggestions">
            <i class="pi pi-info-circle"></i>
            <span>{{ suggestion }}</span>
          </div>
        </div>
      </div>

      <!-- Success Message -->
      <div class="success-message" *ngIf="activationAttempt?.result === 'success'" [@slideInUp]>
        <div class="success-content">
          <i class="pi pi-check-circle" *ngIf="!isNavigating"></i>
          <i class="pi pi-spinner pi-spin" *ngIf="isNavigating"></i>
          <span>{{ activationAttempt?.message || 'تم تفعيل الرمز بنجاح!' }}</span>
        </div>
        
        <div class="navigation-progress" *ngIf="isNavigating">
          <div class="progress-bar">
            <div class="progress-fill"></div>
          </div>
          <small class="text-muted">سيتم توجيهك للدرس خلال ثوانٍ...</small>
        </div>
        
        <div class="success-animation" *ngIf="showSuccessAnimation && !isNavigating">
          <div class="success-checkmark">✓</div>
        </div>
      </div>

      <!-- Error Message -->
      <div class="error-message" 
           *ngIf="activationAttempt?.result && activationAttempt?.result !== 'success'"
           [@slideInUp]>
        <div class="error-content" [class]="'error-' + activationAttempt?.result">
          <i class="pi pi-exclamation-triangle" *ngIf="activationAttempt?.result === 'error'"></i>
          <i class="pi pi-clock" *ngIf="activationAttempt?.result === 'expired'"></i>
          <i class="pi pi-ban" *ngIf="activationAttempt?.result === 'used'"></i>
          <i class="pi pi-times-circle" *ngIf="activationAttempt?.result === 'invalid'"></i>
          <span>{{ activationAttempt?.message }}</span>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="form-actions">
      <button
        type="submit"
        class="btn btn-primary btn-lg"
        [disabled]="submitButtonDisabled"
        (click)="onSubmit()"
      >
        <i class="pi" [ngClass]="{
          'pi-key': !isSubmitting,
          'pi-spinner pi-spin': isSubmitting
        }"></i>
        {{ submitButtonText }}
      </button>
      
      <button
        type="button"
        class="btn btn-outline-secondary"
        (click)="onCancel()"
        [disabled]="isSubmitting"
      >
        إلغاء
      </button>
    </div>
  </form>

  <!-- Instructions -->
  <div class="activation-instructions" *ngIf="showInstructions">
    <div class="instruction-item">
      <i class="pi pi-info-circle"></i>
      <span>الرمز يجب أن يكون بصيغة: LMS-XXXXXXXX-XXXXXXXX</span>
    </div>
    <div class="instruction-item">
      <i class="pi pi-shield"></i>
      <span>كل رمز يمكن استخدامه مرة واحدة فقط</span>
    </div>
    <div class="instruction-item">
      <i class="pi pi-clock"></i>
      <span>تأكد من أن الرمز لم تنته صلاحيته</span>
    </div>
  </div>
</div>