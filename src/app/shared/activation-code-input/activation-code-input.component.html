<div class="activation-code-input">
 

  <!-- Header -->
  <div class="activation-header">
    <div class="header-content">
      <h3 class="activation-title">
        <i class="pi pi-key me-2"></i>
        {{ label }}
      </h3>
      <button class="btn btn-ghost btn-sm close-btn" (click)="onCancel()" [disabled]="isSubmitting">
        <i class="pi pi-times"></i>
      </button>
    </div>
    <p class="activation-description" *ngIf="showInstructions">
      أدخل رمز التفعيل للحصول على وصول فوري للمحتوى
    </p>
  </div>

  <!-- Input Form -->
  <form (ngSubmit)="onSubmit()" class="activation-form" #activationForm="ngForm">
    <!-- Code Input Field -->
    <div class="form-group">
      <label class="form-label">
        <i class="pi pi-shield me-2"></i>
        رمز التفعيل
      </label>
      <div class="input-container">
        <input
          type="text"
          class="form-control code-input"
          [formControl]="codeControl"
          [placeholder]="placeholder"
          [class.is-valid]="validationResult.isValid && codeControl.value"
          [class.is-invalid]="hasValidationErrors && codeControl.touched"
          [attr.aria-describedby]="showValidationHelp ? 'code-help' : null"
          autocomplete="off"
          spellcheck="false"
          maxlength="21"
          (paste)="onCodePaste($event)"
          #codeInput
        >
        <div class="input-icons">
          <i class="pi pi-check text-success" *ngIf="validationResult.isValid && codeControl.value"></i>
          <i class="pi pi-times text-danger" *ngIf="hasValidationErrors && codeControl.touched"></i>
          <i class="pi pi-spinner pi-spin text-primary" *ngIf="isSubmitting"></i>
        </div>
      </div>

      <!-- Validation Help -->
      <div id="code-help" class="form-help" *ngIf="showValidationHelp">
        <div class="validation-errors" *ngIf="hasValidationErrors">
          <div class="error-item" *ngFor="let error of validationResult.errors">
            <i class="pi pi-exclamation-circle"></i>
            <span>{{ error }}</span>
          </div>
        </div>
        <div class="validation-suggestions" *ngIf="validationResult.suggestions && validationResult.suggestions.length > 0">
          <div class="suggestion-item" *ngFor="let suggestion of validationResult.suggestions">
            <i class="pi pi-info-circle"></i>
            <span>{{ suggestion }}</span>
          </div>
        </div>
      </div>

      <!-- Success Message -->
      <div class="success-message" *ngIf="activationAttempt?.result === 'success'" [@slideInUp]>
        <div class="success-content">
          <i class="pi pi-check-circle" *ngIf="!isNavigating"></i>
          <i class="pi pi-spinner pi-spin" *ngIf="isNavigating"></i>
          <span>{{ activationAttempt?.message || 'تم تفعيل الرمز بنجاح!' }}</span>
        </div>
        
        <div class="navigation-progress" *ngIf="isNavigating">
          <div class="progress-bar">
            <div class="progress-fill"></div>
          </div>
          <small class="text-muted">سيتم توجيهك للدرس خلال ثوانٍ...</small>
        </div>
        
        <div class="success-animation" *ngIf="showSuccessAnimation && !isNavigating">
          <div class="success-checkmark">✓</div>
        </div>
      </div>

      <!-- Error Message -->
     <div class="error-message"
          *ngIf="activationAttempt?.result && activationAttempt?.result !== 'success'"
          [@slideInUp]>
        <div class="error-content" [class]="'error-' + activationAttempt?.result">
          <i class="pi pi-times-circle text-danger me-2"></i>
          <span>{{ activationAttempt?.message }}</span>
        </div>
        <div class="error-suggestion" *ngIf="activationAttempt?.result === 'invalid' || activationAttempt?.result === 'error'">
          <i class="pi pi-info-circle text-muted me-1"></i>
          <span>تأكد من كتابة الرمز بشكل صحيح وبالصيغة المطلوبة: LMS-XXXXXXXX-XXXXXXXX</span>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="form-actions">
      <button
        type="submit"
        class="btn btn-primary btn-lg"
        [disabled]="submitButtonDisabled"
        (click)="onSubmit()"
      >
        <i class="pi" [ngClass]="{
          'pi-key': !isSubmitting,
          'pi-spinner pi-spin': isSubmitting
        }"></i>
        {{ submitButtonText }}
      </button>
      
      <button
        type="button"
        class="btn btn-secondary"
        (click)="onCancel()"
        [disabled]="isSubmitting"
      >
        إلغاء
      </button>
    </div>
  </form>

  <!-- Instructions -->
  <div class="activation-instructions" *ngIf="showInstructions">
    <div class="instruction-item">
      <i class="pi pi-info-circle"></i>
      <span>الرمز يجب أن يكون بصيغة: LMS-XXXXXXXX-XXXXXXXX</span>
    </div>
    <div class="instruction-item">
      <i class="pi pi-shield"></i>
      <span>كل رمز يمكن استخدامه مرة واحدة فقط</span>
    </div>
    <div class="instruction-item">
      <i class="pi pi-clock"></i>
      <span>تأكد من أن الرمز لم تنته صلاحيته</span>
    </div>
  </div>
</div>